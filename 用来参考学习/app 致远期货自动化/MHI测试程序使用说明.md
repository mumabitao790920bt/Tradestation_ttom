# MHI交易测试程序使用说明

## 概述
基于致远金融MHI页面的自动化交易测试程序，支持模拟和实盘两种模式下的各种交易操作。

## 文件说明

### 1. 核心文件
- `mhi_trader_test.py` - 完整的交易测试程序
- `mhi_button_tester.py` - 专门的按钮功能测试程序
- `mhi_element_map_template.json` - 元素映射模板

### 2. 配置文件
- `weex_browser_config.json` - 浏览器配置（已配置调试端口）
- `mexc_element_map_1757729194.json` - 元素映射文件（需要更新）

### 3. 辅助文件
- `check_chrome_debug_port.py` - Chrome调试端口检测脚本
- `通过点击获取网页元素.py` - 元素检测器（已更新目标页面）

## 使用步骤

### 第一步：准备环境
1. 确保Chrome浏览器已启动并打开MHI交易页面
2. 确保已登录账户
3. 运行调试端口检测：
   ```bash
   python check_chrome_debug_port.py
   ```

### 第二步：更新元素映射
1. 运行元素检测器：
   ```bash
   python 通过点击获取网页元素.py
   ```
2. 点击"启动浏览器"
3. 逐个点击页面上的按钮，采集元素信息
4. 点击"保存对照表"

### 第三步：运行测试
1. **按钮功能测试**（推荐先运行）：
   ```bash
   python mhi_button_tester.py
   ```
   
2. **完整交易测试**：
   ```bash
   python mhi_trader_test.py
   ```

## 测试功能

### 模式切换测试
- ✅ 模拟模式 ↔ 实盘模式切换
- ✅ 验证当前模式状态

### 订单类型测试
- ✅ 市价订单
- ✅ 限价订单

### 交易模式测试
- ✅ 元模式
- ✅ 角模式

### 手数设置测试
- ✅ 1手、2手、3手、5手、8手、10手

### 保证金设置测试
- ✅ 2700、4050、5850、8100

### 交易操作测试
- ✅ 买涨（做多）
- ✅ 买跌（做空）
- ✅ 止盈价格设置

### 持仓管理测试
- ✅ 查询当前持仓
- ✅ 查询当前委托
- ✅ 查看交易记录
- ✅ 一键平仓

## 安全特性

### 1. 模式保护
- 默认使用模拟模式
- 实盘模式需要用户确认
- 支持模式切换验证

### 2. 操作确认
- 所有交易操作都有确认步骤
- 支持取消操作
- 自动检测确认弹窗

### 3. 错误处理
- 元素未找到时跳过
- 操作失败时记录日志
- 异常时自动恢复

## 日志记录

### 日志文件
- `mhi_trader.log` - 详细操作日志
- 控制台输出 - 实时状态显示

### 日志内容
- 操作时间戳
- 操作类型和结果
- 错误信息和异常
- 页面状态变化

## 注意事项

### 1. 安全提醒
- ⚠️ 实盘模式测试请谨慎操作
- ⚠️ 建议先在模拟模式充分测试
- ⚠️ 确保网络连接稳定

### 2. 元素映射
- 需要根据实际页面更新元素映射
- XPath可能因页面更新而变化
- 建议定期重新采集元素

### 3. 浏览器兼容
- 支持Chrome调试端口模式
- 支持用户数据目录复用
- 需要ChromeDriver支持

## 故障排除

### 1. 浏览器启动失败
- 检查Chrome是否运行
- 验证调试端口配置
- 确认ChromeDriver版本

### 2. 元素找不到
- 重新运行元素检测器
- 检查页面是否完全加载
- 验证元素映射文件

### 3. 操作失败
- 检查网络连接
- 验证登录状态
- 查看详细日志

## 扩展功能

### 1. 自定义测试
可以修改测试程序添加自定义测试场景：
```python
def custom_test():
    # 自定义测试逻辑
    pass
```

### 2. 批量测试
支持批量执行多个测试场景：
```python
test_scenarios = [
    {"mode": "模拟", "lots": 1, "margin": 2700},
    {"mode": "模拟", "lots": 2, "margin": 4050},
    # 更多场景...
]
```

### 3. 结果分析
可以添加测试结果统计和分析功能。

## 联系支持
如有问题，请查看日志文件或联系开发团队。
